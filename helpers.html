<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Helpers &mdash; lightwood 24.3.3.1 documentation</title>
      <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="_static/custom.css" />

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lightwood Philosophy" href="lightwood_philosophy.html" />
    <link rel="prev" title="Analysis" href="analysis.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="index.html">
            
              <img src="_static/mindsdblogo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                24.3.3.1
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorials.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Tutorials</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">API</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="data.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Data</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="encoder.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Encoders</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="mixer.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Mixers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="ensemble.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Ensemble</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="analysis.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Analysis</span></code></a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Helpers</span></code></a><ul>
<li class="toctree-l2"><a class="reference internal" href="#helpers.LightwoodAutocast"><code class="docutils literal notranslate"><span class="pre">LightwoodAutocast</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpers.add_tn_num_conf_bounds"><code class="docutils literal notranslate"><span class="pre">add_tn_num_conf_bounds()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpers.concat_vectors_and_pad"><code class="docutils literal notranslate"><span class="pre">concat_vectors_and_pad()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpers.get_devices"><code class="docutils literal notranslate"><span class="pre">get_devices()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpers.is_cuda_compatible"><code class="docutils literal notranslate"><span class="pre">is_cuda_compatible()</span></code></a></li>
<li class="toctree-l2"><a class="reference internal" href="#helpers.is_none"><code class="docutils literal notranslate"><span class="pre">is_none()</span></code></a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="lightwood_philosophy.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Lightwood</span> <span class="pre">Philosophy</span></code></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">lightwood</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Helpers</span></code></li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/helpers.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="helpers">
<h1><code class="xref py py-mod docutils literal notranslate"><span class="pre">Helpers</span></code><a class="headerlink" href="#helpers" title="Permalink to this heading"></a></h1>
<p>Various helper functions</p>
<span class="target" id="module-helpers"></span><dl class="py class">
<dt class="sig sig-object py" id="helpers.LightwoodAutocast">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">LightwoodAutocast</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">enabled</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/torch.html#LightwoodAutocast"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.LightwoodAutocast" title="Permalink to this definition"></a></dt>
<dd><p>Equivalent to torch.cuda.amp.autocast, but checks device compute capability
to activate the feature only when the GPU has tensor cores to leverage AMP.</p>
<p><strong>Attributes:</strong></p>
<ul class="simple">
<li><p><cite>active</cite> (bool): Whether AMP is currently active. This attribute is at the class</p></li>
</ul>
<p>level</p>
<p><strong>Usage:</strong></p>
<p><a href="#id1"><span class="problematic" id="id2">``</span></a><a href="#id3"><span class="problematic" id="id4">`</span></a>python
&gt;&gt;&gt; import lightwood.helpers.torch as lt
&gt;&gt;&gt; with lt.LightwoodAutocast():
…     # This code will be executed in AMP mode.
…     pass</p>
<p>Initializes the context manager for Automatic Mixed Precision (AMP) functionality.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>enabled</strong> (<em>bool</em><em>, </em><em>optional</em>) – Whether to enable AMP. Defaults to True.</p>
</dd>
</dl>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="helpers.add_tn_num_conf_bounds">
<span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">add_tn_num_conf_bounds</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">data</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">tss_args</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/ts.html#add_tn_num_conf_bounds"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.add_tn_num_conf_bounds" title="Permalink to this definition"></a></dt>
<dd><p>Deprecated. Instead we now opt for the much better solution of having scores for each timestep (see all TS classes in analysis/nc)</p>
<p>Add confidence (and bounds if applicable) to t+n predictions, for n&gt;1
TODO: active research question: how to guarantee 1-e coverage for t+n, n&gt;1
For now, (conservatively) increases width by the confidence times the log of the time step (and a scaling factor).</p>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="helpers.concat_vectors_and_pad">
<span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">concat_vectors_and_pad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">vec_list</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">max_</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/torch.html#concat_vectors_and_pad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.concat_vectors_and_pad" title="Permalink to this definition"></a></dt>
<dd><p>Concatenates a list of input vectors and pads them to match a specified maximum
length.</p>
<p>This function takes a list of input vectors, concatenates them along a specified
dimension (dim=0), and then pads the concatenated vector to achieve a specified
maximum length. The padding is done with zeros.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>vec_list</strong> (<em>list</em><em> of </em><em>torch.Tensor</em>) – List of input vectors to concatenate and pad.</p></li>
<li><p><strong>max</strong> (<em>int</em>) – The maximum length of the concatenated and padded vector.</p></li>
</ul>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>The concatenated and padded vector.</p>
</dd>
<dt class="field-odd">Return type<span class="colon">:</span></dt>
<dd class="field-odd"><p>torch.Tensor</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><p><strong>AssertionError</strong> – If the length of ‘vec_list’ is not greater than 0, or if it
    exceeds ‘max_len’, or if ‘max_len’ is not greater than 0.</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">input_tensors</span> <span class="o">=</span> <span class="p">[</span><span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]),</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">])]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">max_length</span> <span class="o">=</span> <span class="mi">5</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">concatenated_padded</span> <span class="o">=</span> <span class="n">concat_vectors_and_pad</span><span class="p">(</span><span class="n">input_tensors</span><span class="p">,</span> <span class="n">max_length</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">concatenated_padded</span><span class="p">)</span>
<span class="go">tensor([1, 2, 3, 4, 5])</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="helpers.get_devices">
<span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">get_devices</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/device.html#get_devices"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.get_devices" title="Permalink to this definition"></a></dt>
<dd><p>Get the appropriate Torch device(s) based on CUDA availability and compatibility.</p>
<p>This function determines the appropriate Torch device(s) to be used for
computations based on the availability of CUDA and compatible devices. It checks
if CUDA is available and if the available CUDA devices are compatible according to
the ‘is_cuda_compatible()’ function. If compatible devices are found, the function
selects either the first available CUDA device or a randomly selected one based on
the ‘RANDOM_GPU’ environment variable. If CUDA is not available or no compatible
devices are found, the function returns the CPU device.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A tuple containing the selected Torch device and the number of available
devices.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>Tuple</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">device</span><span class="p">,</span> <span class="n">num_devices</span> <span class="o">=</span> <span class="n">get_devices</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
<span class="go">cuda:0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">num_devices</span><span class="p">)</span>
<span class="go">1</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="helpers.is_cuda_compatible">
<span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">is_cuda_compatible</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/device.html#is_cuda_compatible"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.is_cuda_compatible" title="Permalink to this definition"></a></dt>
<dd><p>Check if the system has CUDA-compatible devices with the required architecture and
compiled CUDA version.</p>
<p>This function checks the compatibility of CUDA devices available on the system by
comparing their architectures and the compiled CUDA version. It iterates through
the available devices and verifies if their architectures meet the minimum
requirement specified by the function, and also checks if the compiled CUDA
version is greater than a specific version.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>True if there are compatible CUDA devices, otherwise False.</p>
</dd>
<dt class="field-even">Return type<span class="colon">:</span></dt>
<dd class="field-even"><p>bool</p>
</dd>
</dl>
<p class="rubric">Example</p>
<div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">is_compatible</span> <span class="o">=</span> <span class="n">is_cuda_compatible</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">is_compatible</span><span class="p">)</span>
<span class="go">True</span>
</pre></div>
</div>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="helpers.is_none">
<span class="sig-prename descclassname"><span class="pre">helpers.</span></span><span class="sig-name descname"><span class="pre">is_none</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">value</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/lightwood/helpers/general.html#is_none"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#helpers.is_none" title="Permalink to this definition"></a></dt>
<dd><p>Pandas has no way to guarantee “stability” for the type of a column, it choses to arbitrarily change it based on the values.
Pandas also change the values in the columns based on the types.
Lightwood relies on having <code class="docutils literal notranslate"><span class="pre">None</span></code> values for a cells that represent “missing” or “corrupt”.</p>
<p>When we assign <code class="docutils literal notranslate"><span class="pre">None</span></code> to a cell in a dataframe this might get turned to <cite>nan</cite> or other values, this function checks if a cell is <code class="docutils literal notranslate"><span class="pre">None</span></code> or any other values a pd.DataFrame might convert <code class="docutils literal notranslate"><span class="pre">None</span></code> to.</p>
<p>It also checks some extra values (like <code class="docutils literal notranslate"><span class="pre">''</span></code>) that pandas never converts <code class="docutils literal notranslate"><span class="pre">None</span></code> to (hopefully). But lightwood would still consider those values “None values”, and this will allow for more generic use later.</p>
</dd></dl>

</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="analysis.html" class="btn btn-neutral float-left" title="Analysis" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="lightwood_philosophy.html" class="btn btn-neutral float-right" title="Lightwood Philosophy" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2024, MindsDB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>