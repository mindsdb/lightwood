

<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>api.high_level &mdash; lightwood 25.3.3.0 documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/graphviz.css" />
      <link rel="stylesheet" type="text/css" href="../../_static/custom.css" />

  
      <script src="../../_static/jquery.js"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
      <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
      <script src="../../_static/doctools.js"></script>
      <script src="../../_static/sphinx_highlight.js"></script>
      <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: white" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/mindsdblogo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Tutorials</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">API</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../data.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Data</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../encoder.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Encoders</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../mixer.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Mixers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ensemble.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Ensemble</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../analysis.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Analysis</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../helpers.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Helpers</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../../lightwood_philosophy.html"><code class="xref py py-mod docutils literal notranslate"><span class="pre">Lightwood</span> <span class="pre">Philosophy</span></code></a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: white" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">lightwood</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">api.high_level</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for api.high_level</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span><span class="w"> </span><span class="nn">os</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">typing</span><span class="w"> </span><span class="kn">import</span> <span class="n">Union</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">dill</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">pandas</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">pd</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lightwood.api.types</span><span class="w"> </span><span class="kn">import</span> <span class="n">JsonAI</span><span class="p">,</span> <span class="n">ProblemDefinition</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">dataprep_ml.insights</span><span class="w"> </span><span class="kn">import</span> <span class="n">statistical_analysis</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">type_infer.api</span><span class="w"> </span><span class="kn">import</span> <span class="n">infer_types</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lightwood.api.predictor</span><span class="w"> </span><span class="kn">import</span> <span class="n">PredictorInterface</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lightwood.api.json_ai</span><span class="w"> </span><span class="kn">import</span> <span class="n">generate_json_ai</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lightwood.helpers.codegen</span><span class="w"> </span><span class="kn">import</span> <span class="n">code_from_json_ai</span> <span class="k">as</span> <span class="n">_code_from_json_ai</span><span class="p">,</span> <span class="n">_module_from_code</span><span class="p">,</span> <span class="n">_predictor_from_code</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">sys</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">gc</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">time</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">lightwood.helpers.log</span><span class="w"> </span><span class="kn">import</span> <span class="n">log</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">shutil</span><span class="w"> </span><span class="kn">import</span> <span class="n">copyfile</span>


<span class="k">def</span><span class="w"> </span><span class="nf">load_custom_module</span><span class="p">(</span><span class="n">file_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="kn">from</span><span class="w"> </span><span class="nn">lightwood</span><span class="w"> </span><span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">lightwood_version</span>
    <span class="n">modules_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">expanduser</span><span class="p">(</span><span class="s1">&#39;~/lightwood_modules&#39;</span><span class="p">),</span> <span class="n">lightwood_version</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">,</span> <span class="s1">&#39;_&#39;</span><span class="p">))</span>
    <span class="n">custom_module_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">modules_dir</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">file_path</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">modules_dir</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">modules_dir</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">custom_module_path</span><span class="p">):</span>
        <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">custom_module_path</span><span class="p">)</span>

    <span class="n">copyfile</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="n">custom_module_path</span><span class="p">)</span>


<div class="viewcode-block" id="predictor_from_problem"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.predictor_from_problem">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">predictor_from_problem</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">problem_definition</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProblemDefinition</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">PredictorInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a ready-to-train ``Predictor`` object from some raw data and a ``ProblemDefinition``. Do not use this if you want to edit the JsonAI first. Usually you&#39;d want to next train this predictor by calling the ``learn`` method on the same dataframe used to create it.</span>

<span class="sd">    :param df: The raw data</span>
<span class="sd">    :param problem_definition: The manual specifications for your predictive problem</span>

<span class="sd">    :returns: A lightwood ``Predictor`` object</span>
<span class="sd">    &quot;&quot;&quot;</span> <span class="c1"># noqa</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">,</span> <span class="n">ProblemDefinition</span><span class="p">):</span>
        <span class="n">problem_definition</span> <span class="o">=</span> <span class="n">ProblemDefinition</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dropping features: </span><span class="si">{</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">)</span>

    <span class="n">predictor_class_str</span> <span class="o">=</span> <span class="n">code_from_problem</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">problem_definition</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictor_from_code</span><span class="p">(</span><span class="n">predictor_class_str</span><span class="p">)</span></div>


<div class="viewcode-block" id="json_ai_from_problem"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.json_ai_from_problem">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">json_ai_from_problem</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">problem_definition</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProblemDefinition</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">JsonAI</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a JsonAI from your raw data and problem definition. Usually you would use this when you want to subsequently edit the JsonAI, the easiest way to do this is to unload it to a dictionary via `to_dict`, modify it, and then create a new object from it using `lightwood.JsonAI.from_dict`. It&#39;s usually better to generate the JsonAI using this function rather than writing it from scratch.</span>

<span class="sd">    :param df: The raw data</span>
<span class="sd">    :param problem_definition: The manual specifications for your predictive problem</span>

<span class="sd">    :returns: A ``JsonAI`` object generated based on your data and problem specifications</span>
<span class="sd">    &quot;&quot;&quot;</span> <span class="c1"># noqa</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">,</span> <span class="n">ProblemDefinition</span><span class="p">):</span>
        <span class="n">problem_definition</span> <span class="o">=</span> <span class="n">ProblemDefinition</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">)</span>

    <span class="n">started</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dropping features: </span><span class="si">{</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">)</span>

    <span class="n">type_information</span> <span class="o">=</span> <span class="n">infer_types</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">config</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;engine&#39;</span><span class="p">:</span> <span class="s1">&#39;rule_based&#39;</span><span class="p">,</span> <span class="s1">&#39;pct_invalid&#39;</span><span class="p">:</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">pct_invalid</span><span class="p">})</span>
    <span class="n">stats</span> <span class="o">=</span> <span class="n">statistical_analysis</span><span class="p">(</span>
        <span class="n">df</span><span class="p">,</span> <span class="n">type_information</span><span class="o">.</span><span class="n">dtypes</span><span class="p">,</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(),</span> <span class="n">type_information</span><span class="o">.</span><span class="n">identifiers</span><span class="p">)</span>

    <span class="n">duration</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span> <span class="o">-</span> <span class="n">started</span>
    <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">time_aim</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">problem_definition</span><span class="o">.</span><span class="n">time_aim</span> <span class="o">-=</span> <span class="n">duration</span>
        <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">time_aim</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">:</span>
            <span class="n">problem_definition</span><span class="o">.</span><span class="n">time_aim</span> <span class="o">=</span> <span class="mi">10</span>

    <span class="c1"># Assume that the stuff besides encoder and mixers takes about as long as analyzing did... bad, but let&#39;s see</span>
    <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">expected_additional_time</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">problem_definition</span><span class="o">.</span><span class="n">expected_additional_time</span> <span class="o">=</span> <span class="n">duration</span>
    <span class="n">json_ai</span> <span class="o">=</span> <span class="n">generate_json_ai</span><span class="p">(</span>
        <span class="n">type_information</span><span class="o">=</span><span class="n">type_information</span><span class="p">,</span> <span class="n">statistical_analysis</span><span class="o">=</span><span class="n">stats</span><span class="p">,</span>
        <span class="n">problem_definition</span><span class="o">=</span><span class="n">problem_definition</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">json_ai</span></div>


<div class="viewcode-block" id="code_from_json_ai"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.code_from_json_ai">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">code_from_json_ai</span><span class="p">(</span><span class="n">json_ai</span><span class="p">:</span> <span class="n">JsonAI</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Autogenerates custom code based on the details you specified inside your JsonAI.</span>

<span class="sd">    :param json_ai: A ``JsonAI`` object</span>

<span class="sd">    :returns: Code (text) generate based on the ``JsonAI`` you created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_code_from_json_ai</span><span class="p">(</span><span class="n">json_ai</span><span class="p">)</span></div>


<div class="viewcode-block" id="predictor_from_code"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.predictor_from_code">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">predictor_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictorInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param code: The ``Predictor``&#39;s code in text form</span>

<span class="sd">    :returns: A lightwood ``Predictor`` object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">_predictor_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span></div>


<div class="viewcode-block" id="code_from_problem"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.code_from_problem">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">code_from_problem</span><span class="p">(</span><span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">problem_definition</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">ProblemDefinition</span><span class="p">,</span> <span class="nb">dict</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param df: The raw data</span>
<span class="sd">    :param problem_definition: The manual specifications for your predictive problem</span>

<span class="sd">    :returns: The text code generated based on your data and problem specifications</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">,</span> <span class="n">ProblemDefinition</span><span class="p">):</span>
        <span class="n">problem_definition</span> <span class="o">=</span> <span class="n">ProblemDefinition</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">problem_definition</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Dropping features: </span><span class="si">{</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">problem_definition</span><span class="o">.</span><span class="n">ignore_features</span><span class="p">)</span>

    <span class="n">json_ai</span> <span class="o">=</span> <span class="n">json_ai_from_problem</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">problem_definition</span><span class="p">)</span>
    <span class="n">predictor_code</span> <span class="o">=</span> <span class="n">code_from_json_ai</span><span class="p">(</span><span class="n">json_ai</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictor_code</span></div>


<div class="viewcode-block" id="predictor_from_state"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.predictor_from_state">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">predictor_from_state</span><span class="p">(</span><span class="n">state_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">code</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictorInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    :param state_file: The file containing the pickle resulting from calling ``save`` on a ``Predictor`` object</span>
<span class="sd">    :param code: The ``Predictor``&#39;s code in text form</span>

<span class="sd">    :returns: A lightwood ``Predictor`` object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">state_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">predictor</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="n">module_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span><span class="o">.</span><span class="n">lstrip</span><span class="p">(</span><span class="s2">&quot;No module named &#39;&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;&#39;&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">code</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">Exception</span><span class="p">(</span>
                <span class="s1">&#39;Provide code when loading a predictor from outside the scope/script it was created in!&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">module_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">del</span> <span class="n">sys</span><span class="o">.</span><span class="n">modules</span><span class="p">[</span><span class="n">module_name</span><span class="p">]</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="n">gc</span><span class="o">.</span><span class="n">collect</span><span class="p">()</span>
        <span class="n">_module_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">,</span> <span class="n">module_name</span><span class="p">)</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">state_file</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
            <span class="n">predictor</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">predictor</span></div>


<div class="viewcode-block" id="predictor_from_json_ai"><a class="viewcode-back" href="../../api/high_level.html#api.high_level.predictor_from_json_ai">[docs]</a><span class="k">def</span><span class="w"> </span><span class="nf">predictor_from_json_ai</span><span class="p">(</span><span class="n">json_ai</span><span class="p">:</span> <span class="n">JsonAI</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictorInterface</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Creates a ready-to-train ``Predictor`` object based on the details you specified inside your JsonAI.</span>

<span class="sd">    :param json_ai: A ``JsonAI`` object</span>

<span class="sd">    :returns: A lightwood ``Predictor`` object</span>
<span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
    <span class="n">code</span> <span class="o">=</span> <span class="n">code_from_json_ai</span><span class="p">(</span><span class="n">json_ai</span><span class="p">)</span>
    <span class="n">predictor</span> <span class="o">=</span> <span class="n">predictor_from_code</span><span class="p">(</span><span class="n">code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">predictor</span></div>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2017-2025, MindsDB.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>